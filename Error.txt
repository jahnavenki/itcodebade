$(document).on('dialog-ready', function() {
    var dropdown = $('#apirDropdown');
    var marketingNameField = $('#marketingNameField');

    // Fetch data from the servlet and populate dropdown
    $.ajax({
        url: '/bin/jsonDataDropdown',
        type: 'GET',
        dataType: 'json',
        success: function(data) {
            dropdown.empty(); // Clear existing options
            dropdown.append($('<option></option>').attr('value', '').text('Select APiR')); // Default option

            $.each(data, function(key, value) {
                dropdown.append($('<option></option>').attr('value', key).text(key));
            });

            // Set the initial marketing name if the dropdown already has a value
            setMarketingName(dropdown.val(), data);
        },
        error: function(xhr, status, error) {
            console.error('Failed to fetch dropdown data:', error);
        }
    });

    // Update marketing name when dropdown value changes
    dropdown.on('change', function() {
        var selectedValue = dropdown.val();
        setMarketingName(selectedValue, data);
    });

    function setMarketingName(apir, data) {
        var marketingName = data[apir] || '';
        marketingNameField.val(marketingName);
    }
});
